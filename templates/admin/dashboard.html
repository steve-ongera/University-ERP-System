{% extends 'admin_base.html' %}
{% load static %}

{% block title %}Admin Dashboard - University{% endblock %}

{% block content %}

<link rel="stylesheet" href="{% static 'css/admin_dashboard.css' %}">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<!-- Font Awesome -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<!-- Chart.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

<div class="row mt-3">
    <div class="col-md-12">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
            <i class="bi {% if message.tags == 'success' %}bi-check-circle{% else %}bi-exclamation-triangle{% endif %} me-2"></i>
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
    </div>
</div>

<div class="container onprintContainer">
    <div class="row p-3">
        <div class="row d-flex flex-row">
            <div class="col-md-8">
                <h1 class="fw-bold card-title text-start">University Admin Dashboard</h1>
                <p class="text-muted">Academic Year: {% if current_academic_year %}{{ current_academic_year.year }}{% else %}Not Set{% endif %} | Current Semester: {% if current_semester %}{{ current_semester.semester_number }}{% else %}Not Set{% endif %}</p>
            </div>
            <div class="col-md-4 dashboardRightLabel">
                <div class="text-end">
                    <span class="fw-bold text-muted">Today is {{ current_date|date:"l, F d, Y" }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Summary Cards Row -->
    <div class="row p-2">
        <!-- Users Card -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-primary shadow-sm h-100">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                Total Users</div>
                            <div class="h4 mb-0 font-weight-bold text-gray-800">{{ total_users }}</div>
                            <div class="mt-2 text-muted small">
                                <span class="text-success">{{ active_users }} active</span> | 
                                <span class="text-info">{{ new_users_today }} new today</span>
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-users fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Students Card -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-success shadow-sm h-100">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                Students</div>
                            <div class="h4 mb-0 font-weight-bold text-gray-800">{{ total_students }}</div>
                            <div class="mt-2 text-muted small">
                                <span class="text-success">xx active</span> | 
                                <span class="text-info">{{ new_students_today }} new today</span>
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-user-graduate fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Faculty Card -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-info shadow-sm h-100">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                Lecturers</div>
                            <div class="h4 mb-0 font-weight-bold text-gray-800">{{ total_lecturers }}</div>
                            <div class="mt-2 text-muted small">
                                <span class="text-success">{{ active_lecturers }} active</span>
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-chalkboard-teacher fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Staff Card -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-warning shadow-sm h-100">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                Staff</div>
                            <div class="h4 mb-0 font-weight-bold text-gray-800">{{ total_staff }}</div>
                            <div class="mt-2 text-muted small">
                                <span class="text-success">{{ active_staff }} active</span>
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-user-tie fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="row p-2">
        <!-- Gender Distribution (Donut Chart) -->
        <div class="col-md-4 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-white border-bottom">
                    <h5 class="card-title fw-semibold primary-text">Student Gender Distribution</h5>
                </div>
                <div class="card-body">
                    <canvas id="genderChart" width="400" height="300"></canvas>
                </div>
            </div>
        </div>

        <!-- Student Admissions Trend (Bar Chart) -->
        <div class="col-md-8 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-white border-bottom">
                    <h5 class="card-title fw-semibold primary-text">Student Admissions Trend (Last 5 Years)</h5>
                </div>
                <div class="card-body">
                    <canvas id="admissionTrendChart" width="800" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Programme Enrollment and Student Reporting Row -->
    <div class="row p-2">
        <!-- Programme Enrollment (Line Chart) -->
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-white border-bottom">
                    <h5 class="card-title fw-semibold primary-text">Programme Enrollment</h5>
                </div>
                <div class="card-body">
                    <canvas id="programmeChart" width="400" height="300"></canvas>
                </div>
            </div>
        </div>

        <!-- Student Reporting (Last 6 Semesters) -->
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-white border-bottom">
                    <h5 class="card-title fw-semibold primary-text">Student Reporting (Last 6 Semesters)</h5>
                </div>
                <div class="card-body">
                    <canvas id="reportingChart" width="400" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Row -->
    <div class="row p-2">
        <!-- Left Column -->
        <div class="col-md-8">
            <!-- Academic Overview -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-white border-bottom">
                    <div class="row">
                        <div class="col-md-9">
                            <h5 class="card-title fw-semibold primary-text">Academic Overview</h5>
                        </div>
                        <div class="col-md-3 text-end">
                            <a href="#" class="small text-primary">View All</a>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-6 col-md-3 mb-4">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                Schools</div>
                            <div class="h3 mb-0 font-weight-bold text-gray-800">{{ total_schools }}</div>
                        </div>
                        <div class="col-6 col-md-3 mb-4">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                Programmes</div>
                            <div class="h3 mb-0 font-weight-bold text-gray-800">{{ total_programmes }}</div>
                        </div>
                        <div class="col-6 col-md-3 mb-4">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                Units/Subjects</div>
                            <div class="h3 mb-0 font-weight-bold text-gray-800">{{ total_units }}</div>
                        </div>
                        <div class="col-6 col-md-3 mb-4">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                Clinical Sites</div>
                            <div class="h3 mb-0 font-weight-bold text-gray-800">{{ active_placements }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activities -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-white border-bottom">
                    <div class="row">
                        <div class="col-md-9">
                            <h5 class="card-title fw-semibold primary-text">Recent Activities</h5>
                        </div>
                        <div class="col-md-3 text-end">
                            <a href="#" class="small text-primary">View All</a>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        {% for activity in recent_activities %}
                        <div class="list-group-item list-group-item-action border-0 px-0 py-3">
                            <div class="d-flex w-100 justify-content-between">
                                <div class="d-flex">
                                    <i class="fas {{ activity.icon }} text-{{ activity.color }} me-3 mt-1"></i>
                                    <div>
                                        <p class="mb-1 small">{{ activity.message }}</p>
                                        <small class="text-muted">{{ activity.date|timesince }} ago</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="text-center text-muted py-3">
                            No recent activities
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Fee Collection Trends -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-white border-bottom">
                    <h5 class="card-title fw-semibold primary-text">Fee Collection Trends (Last 12 Months)</h5>
                </div>
                <div class="card-body">
                    <canvas id="collectionChart" width="800" height="400"></canvas>
                </div>
            </div>
        </div>

        <!-- Right Column -->
        <div class="col-md-4">
            <!-- Financial Overview -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-white border-bottom">
                    <h5 class="card-title fw-semibold primary-text">Financial Overview</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center mb-3">
                        <div class="col-6">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                Total Payments</div>
                            <div class="h3 mb-0 font-weight-bold text-gray-800">{{ total_fee_payments }}</div>
                        </div>
                        <div class="col-6">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                Today's Payments</div>
                            <div class="h3 mb-0 font-weight-bold text-gray-800">{{ today_fee_payments }}</div>
                        </div>
                    </div>
                    
                    <h6 class="fw-semibold primary-text mb-3">Recent Payments</h6>
                    <div class="list-group list-group-flush">
                        {% for payment in recent_payments %}
                        <div class="list-group-item list-group-item-action border-0 px-0 py-2">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1 small fw-semibold">{{ payment.student.registration_number }}</h6>
                                <span class="text-success fw-bold">KES {{ payment.amount_paid|floatformat:0 }}</span>
                            </div>
                            <small class="text-muted">{{ payment.payment_method|title }} - {{ payment.payment_date|date:"M d, Y" }}</small>
                        </div>
                        {% empty %}
                        <div class="text-center text-muted py-3">
                            No recent payments
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Top Performing Students -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-white border-bottom">
                    <h5 class="card-title fw-semibold primary-text">Top Performing Students</h5>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        {% for student_data in top_students %}
                        <div class="list-group-item list-group-item-action border-0 px-0 py-2">
                            <div class="d-flex w-100 justify-content-between">
                                <div>
                                    <h6 class="mb-1 small fw-semibold">{{ student_data.student.user.get_full_name }}</h6>
                                    <small class="text-muted">{{ student_data.student.registration_number }} - {{ student_data.student.programme.name }}</small>
                                </div>
                                <span class="badge bg-success">{{ student_data.gpa }} GPA</span>
                            </div>
                        </div>
                        {% empty %}
                        <div class="text-center text-muted py-3">
                            No data available
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-white border-bottom">
                    <h5 class="card-title fw-semibold primary-text">Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="#" class="btn btn-primary btn-sm">
                            <i class="fas fa-user-plus me-1"></i> Add Student
                        </a>
                        <a href="#" class="btn btn-success btn-sm">
                            <i class="fas fa-chalkboard-teacher me-1"></i> Add Faculty
                        </a>
                        <a href="#" class="btn btn-info btn-sm">
                            <i class="fas fa-graduation-cap me-1"></i> Add Programme
                        </a>
                        <a href="#" class="btn btn-warning btn-sm">
                            <i class="fas fa-money-bill me-1"></i> Record Payment
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Programme Performance Row -->
    <div class="row p-2">
        <!-- Programme Performance Chart -->
        <div class="col-md-12">
            <div class="card shadow-sm">
                <div class="card-header bg-white border-bottom">
                    <div class="row">
                        <div class="col-md-9">
                            <h5 class="card-title fw-semibold primary-text">Programme Performance (Average GPA)</h5>
                        </div>
                        <div class="col-md-3 text-end">
                            <a href="#" class="small text-primary">View Details</a>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <canvas id="performanceChart" width="800" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Additional Summary Row -->
    <div class="row p-2">
        <!-- Clinical Placements Overview -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-white border-bottom">
                    <div class="row">
                        <div class="col-md-9">
                            <h5 class="card-title fw-semibold primary-text">Clinical Placements</h5>
                        </div>
                        <div class="col-md-3 text-end">
                            <a href="#" class="small text-primary">Manage</a>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row text-center mb-3">
                        <div class="col-6">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                Active</div>
                            <div class="h3 mb-0 font-weight-bold text-gray-800">{{ active_placements }}</div>
                        </div>
                        <div class="col-6">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                Completed</div>
                            <div class="h3 mb-0 font-weight-bold text-gray-800">{{ completed_placements }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Current Semester Attendance -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-white border-bottom">
                    <div class="row">
                        <div class="col-md-9">
                            <h5 class="card-title fw-semibold primary-text">Current Semester Attendance</h5>
                        </div>
                        <div class="col-md-3 text-end">
                            <a href="#" class="small text-primary">View All</a>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <canvas id="attendanceChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

    <script>
        // Chart.js Configuration
        Chart.defaults.font.family = "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
        Chart.defaults.plugins.legend.position = 'bottom';

        // Gender Distribution Donut Chart
        const genderData = {{ gender_chart_data|safe }};
        const genderCtx = document.getElementById('genderChart').getContext('2d');
        new Chart(genderCtx, {
            type: 'doughnut',
            data: {
                labels: genderData.labels,
                datasets: [{
                    data: genderData.data,
                    backgroundColor: genderData.colors,
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            usePointStyle: true
                        }
                    }
                },
                cutout: '60%'
            }
        });

        // Admission Trend Bar Chart
        const admissionData = {{ admission_trend_data|safe }};
        const admissionCtx = document.getElementById('admissionTrendChart').getContext('2d');
        new Chart(admissionCtx, {
            type: 'bar',
            data: {
                labels: admissionData.labels,
                datasets: [{
                    label: 'New Admissions',
                    data: admissionData.data,
                    backgroundColor: 'rgba(52, 152, 219, 0.8)',
                    borderColor: 'rgba(52, 152, 219, 1)',
                    borderWidth: 1,
                    borderRadius: 5
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0,0,0,0.1)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });

        // Programme Enrollment Chart
        // FIXED: Programme Enrollment Chart (Horizontal Bar Chart)
        const programmeData = {{ programme_chart_data|safe }};
        const programmeCtx = document.getElementById('programmeChart').getContext('2d');
        new Chart(programmeCtx, {
            type: 'bar',
            data: {
                labels: programmeData.labels,
                datasets: [{
                    label: 'Students Enrolled',
                    data: programmeData.data,
                    backgroundColor: 'rgba(39, 174, 96, 0.8)',
                    borderColor: 'rgba(39, 174, 96, 1)',
                    borderWidth: 1,
                    borderRadius: 5
                }]
            },
            options: {
                indexAxis: 'y', // This makes it horizontal
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0,0,0,0.1)'
                        }
                    },
                    y: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            maxTicksLimit: 10 // Limit number of labels shown
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            title: function(context) {
                                return context[0].label;
                            },
                            label: function(context) {
                                return 'Students: ' + context.parsed.x;
                            }
                        }
                    }
                }
            }
        });


        // Student Reporting Chart
        // FIXED: Student Reporting Chart (Line Chart with multiple datasets)
        const reportingData = {{ reporting_chart_data|safe }};
        const reportingCtx = document.getElementById('reportingChart').getContext('2d');
        new Chart(reportingCtx, {
            type: 'line',
            data: {
                labels: reportingData.labels,
                datasets: [{
                    label: 'Students Reported',
                    data: reportingData.reported,
                    borderColor: 'rgba(39, 174, 96, 1)',
                    backgroundColor: 'rgba(39, 174, 96, 0.1)',
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: 'rgba(39, 174, 96, 1)',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 5
                }, {
                    label: 'Expected Students',
                    data: reportingData.expected,
                    borderColor: 'rgba(231, 76, 60, 1)',
                    backgroundColor: 'rgba(231, 76, 60, 0.1)',
                    tension: 0.4,
                    fill: false,
                    borderDash: [5, 5],
                    pointBackgroundColor: 'rgba(231, 76, 60, 1)',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 5
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0,0,0,0.1)'
                        },
                        ticks: {
                            callback: function(value) {
                                return Math.floor(value); // Show only integer values
                            }
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            afterBody: function(context) {
                                const dataIndex = context[0].dataIndex;
                                const percentage = reportingData.percentages[dataIndex];
                                return 'Reporting Rate: ' + percentage + '%';
                            }
                        }
                    }
                },
                interaction: {
                    mode: 'nearest',
                    axis: 'x',
                    intersect: false
                }
            }
        });

        // Course Enrollment Trends
        const enrollmentData = {{ enrollment_trend_data|safe }};
        const enrollmentCtx = document.getElementById('enrollmentTrendChart').getContext('2d');
        new Chart(enrollmentCtx, {
            type: 'line',
            data: {
                labels: enrollmentData.labels,
                datasets: [{
                    label: 'Course Enrollments',
                    data: enrollmentData.data,
                    borderColor: 'rgba(155, 89, 182, 1)',
                    backgroundColor: 'rgba(155, 89, 182, 0.1)',
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: 'rgba(155, 89, 182, 1)',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0,0,0,0.1)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });

        // Programme Performance Chart
        const performanceData = {{ performance_chart_data|safe }};
        const performanceCtx = document.getElementById('performanceChart').getContext('2d');
        new Chart(performanceCtx, {
            type: 'bar',
            data: {
                labels: performanceData.labels,
                datasets: [{
                    label: 'Average GPA',
                    data: performanceData.data,
                    backgroundColor: 'rgba(243, 156, 18, 0.8)',
                    borderColor: 'rgba(243, 156, 18, 1)',
                    borderWidth: 1,
                    borderRadius: 5
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 4.0,
                        grid: {
                            color: 'rgba(0,0,0,0.1)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });

        // Department Distribution Chart
        const departmentData = {{ department_chart_data|safe }};
        const departmentCtx = document.getElementById('departmentChart').getContext('2d');
        new Chart(departmentCtx, {
            type: 'doughnut',
            data: {
                labels: departmentData.labels,
                datasets: [{
                    data: departmentData.data,
                    backgroundColor: [
                        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
                        '#9966FF', '#FF9F40', '#FF6384', '#C9CBCF'
                    ],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 15,
                            usePointStyle: true,
                            font: {
                                size: 10
                            }
                        }
                    }
                },
                cutout: '50%'
            }
        });

        // Programme Type Distribution
        const programmeTypeData = {{ programme_type_chart_data|safe }};
        const programmeTypeCtx = document.getElementById('programmeTypeChart').getContext('2d');
        new Chart(programmeTypeCtx, {
            type: 'pie',
            data: {
                labels: programmeTypeData.labels,
                datasets: [{
                    data: programmeTypeData.data,
                    backgroundColor: programmeTypeData.colors,
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            usePointStyle: true
                        }
                    }
                }
            }
        });

        // Grade Distribution Chart
        const gradeData = {{ grade_chart_data|safe }};
        const gradeCtx = document.getElementById('gradeChart').getContext('2d');
        new Chart(gradeCtx, {
            type: 'bar',
            data: {
                labels: gradeData.labels,
                datasets: [{
                    label: 'Number of Students',
                    data: gradeData.data,
                    backgroundColor: 'rgba(52, 152, 219, 0.8)',
                    borderColor: 'rgba(52, 152, 219, 1)',
                    borderWidth: 1,
                    borderRadius: 5
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0,0,0,0.1)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });

        // User Type Distribution Chart
        const userTypeData = {{ user_type_chart_data|safe }};
        const userTypeCtx = document.getElementById('userTypeChart').getContext('2d');
        new Chart(userTypeCtx, {
            type: 'doughnut',
            data: {
                labels: userTypeData.labels,
                datasets: [{
                    data: userTypeData.data,
                    backgroundColor: userTypeData.colors,
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 15,
                            usePointStyle: true,
                            font: {
                                size: 10
                            }
                        }
                    }
                },
                cutout: '60%'
            }
        });
    </script>
{% endblock %}