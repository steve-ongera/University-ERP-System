{% extends 'admin_base.html' %}
{% load static %}

{% block content %}

<div class="message-container" id="system-messages">
    {% for message in messages %}
    <div class="alert-message alert-{{ message.tags }}">
        {{ message }}
        <span class="close-message">&times;</span>
    </div>
    {% endfor %}
</div>

<div class="container onprintContainer">
    <!-- Page Header -->
    <div class="row p-3">
        <div class="card shadow-sm">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <div class="d-flex align-items-center mb-2">
                            <h2 class="fw-bold mb-0 me-3">{{ course.name }}</h2>
                            <span class="badge bg-primary fs-6">{{ course.code }}</span>
                            {% if course.is_active %}
                                <span class="badge bg-success ms-2">Active</span>
                            {% else %}
                                <span class="badge bg-danger ms-2">Inactive</span>
                            {% endif %}
                        </div>
                        <p class="text-muted mb-0">
                            {{ course.department.name }} | {{ course.department.faculty.name }}
                        </p>
                    </div>
                    <div class="col-md-4 text-end">
                        <a href="{% url 'edit_course' course.id %}" class="btn btn-primary me-2">
                            <i class="bi bi-pencil"></i> Edit Course
                        </a>
                        <a href="{% url 'course_list' %}" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left"></i> Back to Courses
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Course Information -->
    <div class="row p-3">
        <!-- Left Column -->
        <div class="col-md-8">
            <!-- Basic Information -->
            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-info-circle me-2"></i>Basic Information</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <strong>Course Type:</strong>
                            <span class="badge bg-{% if course.course_type == 'core' %}info{% elif course.course_type == 'elective' %}success{% elif course.course_type == 'major' %}warning{% else %}secondary{% endif %} ms-2">
                                {{ course.get_course_type_display }}
                            </span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <strong>Course Level:</strong>
                            <span class="ms-2">{{ course.get_level_display }}</span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <strong>Credit Hours:</strong>
                            <span class="ms-2">{{ course.credit_hours }} hours</span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <strong>Total Contact Hours:</strong>
                            <span class="ms-2">{{ course.total_contact_hours }} hours</span>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-3 mb-2">
                            <small class="text-muted">Lecture Hours:</small>
                            <div class="fw-bold">{{ course.lecture_hours }}</div>
                        </div>
                        <div class="col-md-3 mb-2">
                            <small class="text-muted">Tutorial Hours:</small>
                            <div class="fw-bold">{{ course.tutorial_hours }}</div>
                        </div>
                        <div class="col-md-3 mb-2">
                            <small class="text-muted">Practical Hours:</small>
                            <div class="fw-bold">{{ course.practical_hours }}</div>
                        </div>
                        <div class="col-md-3 mb-2">
                            <small class="text-muted">Field Work Hours:</small>
                            <div class="fw-bold">{{ course.field_work_hours }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Course Description -->
            {% if course.description %}
            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-file-earmark-text me-2"></i>Course Description</h5>
                </div>
                <div class="card-body">
                    <p class="mb-0">{{ course.description|linebreaks }}</p>
                </div>
            </div>
            {% endif %}

            <!-- Learning Outcomes -->
            {% if course.learning_outcomes %}
            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-bullseye me-2"></i>Learning Outcomes</h5>
                </div>
                <div class="card-body">
                    <p class="mb-0">{{ course.learning_outcomes|linebreaks }}</p>
                </div>
            </div>
            {% endif %}

            <!-- Assessment Methods -->
            {% if course.assessment_methods %}
            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-clipboard-check me-2"></i>Assessment Methods</h5>
                </div>
                <div class="card-body">
                    <p class="mb-0">{{ course.assessment_methods|linebreaks }}</p>
                </div>
            </div>
            {% endif %}

            <!-- Recommended Textbooks -->
            {% if course.recommended_textbooks %}
            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-book me-2"></i>Recommended Textbooks</h5>
                </div>
                <div class="card-body">
                    <p class="mb-0">{{ course.recommended_textbooks|linebreaks }}</p>
                </div>
            </div>
            {% endif %}

            <!-- Prerequisites -->
            {% if prerequisites %}
            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-arrow-right-circle me-2"></i>Prerequisites</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for prereq in prerequisites %}
                        <div class="col-md-6 mb-2">
                            <div class="d-flex align-items-center">
                                <span class="badge bg-warning me-2">{{ prereq.code }}</span>
                                <a href="{% url 'course_detail' prereq.id %}" class="text-decoration-none">
                                    {{ prereq.name }}
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Prerequisite For -->
            {% if prerequisite_for %}
            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-arrow-left-circle me-2"></i>Prerequisite For</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for course_req in prerequisite_for %}
                        <div class="col-md-6 mb-2">
                            <div class="d-flex align-items-center">
                                <span class="badge bg-info me-2">{{ course_req.code }}</span>
                                <a href="{% url 'course_detail' course_req.id %}" class="text-decoration-none">
                                    {{ course_req.name }}
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Right Column -->
        <div class="col-md-4">
            <!-- Quick Stats -->
            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-graph-up me-2"></i>Quick Stats</h5>
                </div>
                <div class="card-body">
                    <div class="text-center mb-3">
                        <h3 class="text-primary mb-0">{{ current_enrollments }}</h3>
                        <small class="text-muted">Current Enrollments</small>
                    </div>
                    <div class="text-center mb-3">
                        <h3 class="text-success mb-0">{{ programme_courses|length }}</h3>
                        <small class="text-muted">Programme Allocations</small>
                    </div>
                    <div class="text-center">
                        <h3 class="text-warning mb-0">{{ prerequisites|length }}</h3>
                        <small class="text-muted">Prerequisites</small>
                    </div>
                </div>
            </div>

            <!-- Programme Allocations -->
            {% if programme_courses %}
            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-collection me-2"></i>Programme Allocations</h5>
                </div>
                <div class="card-body">
                    {% for pc in programme_courses %}
                    <div class="mb-3 p-2 border rounded">
                        <div class="fw-bold">{{ pc.programme.name }}</div>
                        <small class="text-muted">
                            Year {{ pc.year }}, Semester {{ pc.semester }}
                            {% if pc.is_mandatory %}
                                <span class="badge bg-danger ms-1">Mandatory</span>
                            {% else %}
                                <span class="badge bg-success ms-1">Elective</span>
                            {% endif %}
                        </small>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Actions -->
            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-gear me-2"></i>Actions</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{% url 'edit_course' course.id %}" class="btn btn-primary">
                            <i class="bi bi-pencil me-2"></i>Edit Course
                        </a>
                        <a href="{% url 'delete_course' course.id %}" class="btn btn-outline-danger">
                            <i class="bi bi-trash me-2"></i>Delete Course
                        </a>
                        <hr class="my-2">
                        <a href="{% url 'course_list' %}" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left me-2"></i>Back to Courses
                        </a>
                    </div>
                </div>
            </div>

            <!-- Course Metadata -->
            <div class="card shadow-sm">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-info-square me-2"></i>Course Information</h5>
                </div>
                <div class="card-body">
                    <div class="mb-2">
                        <small class="text-muted">Course ID:</small>
                        <div class="fw-bold">#{{ course.id }}</div>
                    </div>
                    <div class="mb-2">
                        <small class="text-muted">Department:</small>
                        <div class="fw-bold">{{ course.department.name }}</div>
                    </div>
                    <div class="mb-2">
                        <small class="text-muted">Faculty:</small>
                        <div class="fw-bold">{{ course.department.faculty.name }}</div>
                    </div>
                    <div class="mb-2">
                        <small class="text-muted">Status:</small>
                        <div>
                            {% if course.is_active %}
                                <span class="badge bg-success">Active</span>
                            {% else %}
                                <span class="badge bg-danger">Inactive</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.badge {
    font-size: 0.8rem;
}

.card-header h5 {
    color: #495057;
}

.border {
    border-color: #dee2e6 !important;
}

.fw-bold {
    font-weight: 600 !important;
}
</style>

{% endblock %}